services:
  # Backend service (prover server)
  prover-server:
    build: ./server
    ports:
      - "9816" # WebSocket server port (HTTP)
      # - "55688:55688" # no required for demo
    restart: unless-stopped
    container_name: prover-server
    environment:
      - RUST_LOG=info

  # Frontend service (verifier webapp)
  verifier-webapp:
    build:
      context: ./webapp
      args:
        PROVER_PROXY_URL: wss://devconnect-local.tlsnotary.org/prove
        # PROVER_PROXY_URL: wss://localhost:8443/prove
        POAP_LINK: "https://poap.gallery/event/your-event-id"  # Set to empty string to hide POAP section
    restart: unless-stopped
    ports:
      - "80"
    container_name: verifier-webapp
    depends_on:
      - prover-server
    environment:
      - RUST_LOG=info

  # Caddy proxy for HTTPS + WebSocket proxy
  caddy:
    image: caddy:alpine
    ports:
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - ../devops/certs:/certs:ro
    depends_on:
      - verifier-webapp
      - prover-server
    restart: unless-stopped
    container_name: prover-caddy
